@{
    ViewData["Title"] = "Ask a public question";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css">

<form action="/ask" method="post"> <!--- Or your appropriate action URL --->
    @Html.AntiForgeryToken()

    <label for="Title">Title</label>
    <input type="text" name="Title" id="Title" maxlength="300" />
    <span class="text-danger" id="Title-error"></span> <!--- For displaying validation errors --->

    <label for="Body">Body</label>
    <textarea id="easymde-editor" name="Body"></textarea>
    <span class="text-danger" id="Body-error"></span> <!--- For displaying validation errors --->


    <label for="tags">Tags</label>
    <div id="tag-container"></div>
    <input type="text" id="tag-input" placeholder="Add tag..." />
    <input type="hidden" name="Tags" id="hidden-tags" />


    <button type="submit">Post question</button>
</form>

<script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"></script>
<script>
    var easyMDE = new EasyMDE({
        element: document.getElementById("easymde-editor"),
        spellChecker: false,
        promptURLs: true,
        toolbar: ["bold", "italic", "strikethrough", "quote", "|", "code", "link", "image", "|", "preview", "guide"],
        autosave: { enabled: false },
        status: false
    });

    const tagContainer = document.getElementById('tag-container');
    const tagInput = document.getElementById('tag-input');
    const hiddenTagsInput = document.getElementById('hidden-tags');
    let tags = [];

    tagInput.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' || e.key === ',') {
            e.preventDefault();
            const tag = tagInput.value.trim();
            if (tag !== '' && !tags.includes(tag)) {
                tags.push(tag);
                updateTags();
            }
            tagInput.value = '';
        } else if (e.key === 'Backspace' && tagInput.value === '') {
            tags.pop();
            updateTags();
        }
    });

    function updateTags() {
        tagContainer.innerHTML = '';
        tags.forEach(tag => {
            const tagElement = document.createElement('div');
            tagElement.textContent = tag;
            tagElement.className = "tag";
            const closeButton = document.createElement('button');
            closeButton.textContent = 'Ã—';
            closeButton.className = "tag-close";
            closeButton.addEventListener('click', () => {
                tags = tags.filter(t => t !== tag);
                updateTags();
            });
            tagElement.appendChild(closeButton);
            tagContainer.appendChild(tagElement);
        });

        hiddenTagsInput.value = tags.join(',');
    }

    // Basic client-side validation (replace with your preferred method)
    document.getElementById('Title').addEventListener('blur', function () {
        validateField('Title', 'Title-error', 'Title is required.');
    });
    document.getElementById('easymde-editor').addEventListener('blur', function () {
        validateField('Body', 'Body-error', 'Body is required.');
    });

    function validateField(fieldId, errorId, errorMessage) {
        const field = document.getElementById(fieldId);
        const errorSpan = document.getElementById(errorId);

        if (field.value.trim() === '') {
            errorSpan.textContent = errorMessage;
        } else {
            errorSpan.textContent = '';
        }
    }

</script>